{% extends "base.html" %}

{% block title %}Health Dashboard - WellNest{% endblock %}

{% block styles %}
<style>
    :root {
        --primary-red: #dc3545;
        --primary-light: #ffebee;
        --primary-dark: #b71c1c;
    }
    
    .health-header {
        background: linear-gradient(135deg, var(--primary-red), var(--primary-dark));
        color: white;
        padding: 2rem 0;
        margin-bottom: 1rem;
    }
    
    .card {
        border: 1px solid #f5f5f5;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: all 0.3s ease;
        margin-bottom: 1.5rem;
        background-color: white;
        margin-top:1.5rem;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.2);
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    .card-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--primary-red);
    }
    
    .section-title {
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
        font-weight: 600;
        border-bottom: 2px solid var(--primary-light);
        padding-bottom: 0.5rem;
    }
    
    .btn-primary {
        background-color: var(--primary-red);
        border-color: var(--primary-red);
    }
    
    .btn-primary:hover, .btn-primary:focus {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
    }
    
    .text-primary {
        color: var(--primary-red) !important;
    }
</style>
{% endblock %}

{% block content %}
    <!-- Health Dashboard Header -->
    <header class="health-header text-center" style="padding-top: 50px;">
        <div class="container">
            <h1><i class="bi bi-heart-pulse-fill me-2"></i> Health Dashboard</h1>
            <p class="lead">Track and manage your health metrics</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Quick Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="bi bi-heart-pulse"></i>
                        </div>
                        <h5>Heart Rate</h5>
                        {% if health_metrics and health_metrics[0].heart_rate %}
                            <h3 class="text-primary">{{ health_metrics[0].heart_rate }} <small class="text-muted">bpm</small></h3>
                        {% else %}
                            <h3 class="text-primary">-- <small class="text-muted">bpm</small></h3>
                        {% endif %}
                        <p class="text-muted">Resting</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="bi bi-rulers"></i>
                        </div>
                        <h5>Height</h5>
                        {% if health_metrics and health_metrics[0].height %}
                            <h3 class="text-primary">{{ health_metrics[0].height }} <small class="text-muted">cm</small></h3>
                        {% else %}
                            <h3 class="text-primary">-- <small class="text-muted">cm</small></h3>
                        {% endif %}
                        <p class="text-muted">Latest</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="bi bi-speedometer2"></i>
                        </div>
                        <h5>Weight</h5>
                        {% if health_metrics and health_metrics[0].weight %}
                            <h3 class="text-primary">{{ health_metrics[0].weight }} <small class="text-muted">kg</small></h3>
                        {% else %}
                            <h3 class="text-primary">-- <small class="text-muted">kg</small></h3>
                        {% endif %}
                        <p class="text-muted">Latest</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="bi bi-heart-pulse-fill"></i>
                        </div>
                        <h5>Blood Pressure</h5>
                        {% if health_metrics and health_metrics[0].systolic and health_metrics[0].diastolic %}
                            <h3 class="text-primary">{{ health_metrics[0].systolic }}/{{ health_metrics[0].diastolic }} <small class="text-muted">mmHg</small></h3>
                        {% else %}
                            <h3 class="text-primary">--/-- <small class="text-muted">mmHg</small></h3>
                        {% endif %}
                        <p class="text-muted">Latest</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <div class="card-icon">
                            <i class="bi bi-droplet-fill"></i>
                        </div>
                        <h5>Blood Sugar</h5>
                        {% if health_metrics and health_metrics[0].blood_sugar %}
                            <h3 class="text-primary">{{ health_metrics[0].blood_sugar }} <small class="text-muted">mg/dL</small></h3>
                        {% else %}
                            <h3 class="text-primary">-- <small class="text-muted">mg/dL</small></h3>
                        {% endif %}
                        <p class="text-muted">Latest</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Health Metrics Input Section -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="section-title"><i class="bi bi-clipboard2-pulse me-2"></i>Health Metrics Tracker</h4>
                        <form id="healthMetricsForm" method="post" action="/submit_health_metrics">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title"><i class="bi bi-heart-pulse me-2 text-primary"></i>Blood Pressure</h5>
                                            <div class="row g-2 mt-2">
                                                <div class="col-6">
                                                    <label for="systolic" class="form-label">Systolic (mmHg)</label>
                                                    <input type="number" class="form-control" id="systolic" name="systolic" placeholder="120" min="70" max="250">
                                                </div>
                                                <div class="col-6">
                                                    <label for="diastolic" class="form-label">Diastolic (mmHg)</label>
                                                    <input type="number" class="form-control" id="diastolic" name="diastolic" placeholder="80" min="40" max="150">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title"><i class="bi bi-droplet-fill me-2 text-primary"></i>Blood Sugar</h5>
                                            <div class="mt-2">
                                                <label for="bloodSugar" class="form-label">Blood Sugar Level (mg/dL)</label>
                                                <input type="number" class="form-control" id="bloodSugar" name="bloodSugar" placeholder="100" min="40" max="500">
                                                <div class="form-text">Fasting: 70-100 mg/dL is normal</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title"><i class="bi bi-rulers me-2 text-primary"></i>Height</h5>
                                            <div class="mt-2">
                                                <label for="height" class="form-label">Height (cm)</label>
                                                <input type="number" class="form-control" id="height" name="height" placeholder="170" min="50" max="250" step="0.1">
                                                <div class="form-text">Enter your height in centimeters</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title"><i class="bi bi-speedometer2 me-2 text-primary"></i>Weight</h5>
                                            <div class="mt-2">
                                                <label for="weight" class="form-label">Weight (kg)</label>
                                                <input type="number" class="form-control" id="weight" name="weight" placeholder="70" min="20" max="300" step="0.1">
                                                <div class="form-text">Enter your weight in kilograms</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title"><i class="bi bi-heart me-2 text-primary"></i>Heart Rate</h5>
                                            <div class="mt-2">
                                                <label for="heartRate" class="form-label">Heart Rate (bpm)</label>
                                                <input type="number" class="form-control" id="heartRate" name="heartRate" placeholder="72" min="40" max="220">
                                                <div class="form-text">Normal resting: 60-100 bpm</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 mt-3">
                                    <button type="submit" class="btn btn-primary"><i class="bi bi-save me-2"></i>Save Measurements</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Health Metrics History -->
        <div class="row mt-4 mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h4 class="section-title"><i class="bi bi-clock-history me-2"></i>Recent Health Metrics</h4>
                        {% if health_metrics %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Blood Pressure</th>
                                            <th>Status</th>
                                            <th>Blood Sugar</th>
                                            <th>Status</th>
                                            <th>Height (cm)</th>
                                            <th>Weight (kg)</th>
                                            <th>Heart Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for metric in health_metrics %}
                                        <tr>
                                            <td>{{ metric.date }}</td>
                                            <td>{{ metric.systolic }}/{{ metric.diastolic }} mmHg</td>
                                            <td>
                                                {% if metric.systolic < 120 and metric.diastolic < 80 %}
                                                    <span class="badge bg-success">Normal</span>
                                                {% elif metric.systolic < 130 and metric.diastolic < 80 %}
                                                    <span class="badge bg-success">Elevated</span>
                                                {% elif metric.systolic < 140 or metric.diastolic < 90 %}
                                                    <span class="badge bg-warning">Stage 1</span>
                                                {% elif metric.systolic < 180 or metric.diastolic < 120 %}
                                                    <span class="badge bg-danger">Stage 2</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Crisis</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ metric.blood_sugar }} mg/dL</td>
                                            <td>
                                                {% if metric.blood_sugar < 70 %}
                                                    <span class="badge bg-warning">Low</span>
                                                {% elif metric.blood_sugar <= 100 %}
                                                    <span class="badge bg-success">Normal</span>
                                                {% elif metric.blood_sugar > 180 %}
                                                    <span class="badge bg-danger">High</span>
                                                {% else %}
                                                    <span class="badge bg-warning">Pre-Diabetic</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ metric.height|default('-', true) }}</td>
                                            <td>{{ metric.weight|default('-', true) }}</td>
                                            <td>{{ metric.heart_rate|default('-', true) }}{% if metric.heart_rate %} bpm{% endif %}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i> No health metrics recorded yet. Use the form above to start tracking your health.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('healthMetricsForm');
        
        if (form) {
            form.addEventListener('submit', function(e) {
                // Form validation could be added here if needed
                // This is just a basic example
                
                // You could also use AJAX to submit the form without page reload
                // For simplicity, we're using a regular form submission
            });
        }
    });
</script>
{% endblock %}
